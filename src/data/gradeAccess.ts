import { GradeAccess } from '../types';

export const gradeAccessCodes: GradeAccess[] = [
  // Grade 1 access codes
  { grade: 1, name: 'الصف الأول الأساسي', code: 'ELEM1ST2024' },
  { grade: 1, name: 'الصف الأول الأساسي', code: 'GRADE1KEY1' },
  { grade: 1, name: 'الصف الأول الأساسي', code: 'GRADE1KEY2' },
  { grade: 1, name: 'الصف الأول الأساسي', code: 'GRADE1KEY3' },
  { grade: 1, name: 'الصف الأول الأساسي', code: 'GRADE1KEY4' },
  { grade: 1, name: 'الصف الأول الأساسي', code: 'GRADE1KEY5' },
  
  // Grade 2 access codes
  { grade: 2, name: 'الصف الثاني الأساسي', code: 'ELEM2ND2024' },
  { grade: 2, name: 'الصف الثاني الأساسي', code: 'GRADE2KEY1' },
  { grade: 2, name: 'الصف الثاني الأساسي', code: 'GRADE2KEY2' },
  { grade: 2, name: 'الصف الثاني الأساسي', code: 'GRADE2KEY3' },
  { grade: 2, name: 'الصف الثاني الأساسي', code: 'GRADE2KEY4' },
  { grade: 2, name: 'الصف الثاني الأساسي', code: 'GRADE2KEY5' },
  
  // Grade 3 access codes
  { grade: 3, name: 'الصف الثالث الأساسي', code: 'ELEM3RD2024' },
  { grade: 3, name: 'الصف الثالث الأساسي', code: 'GRADE3KEY1' },
  { grade: 3, name: 'الصف الثالث الأساسي', code: 'GRADE3KEY2' },
  { grade: 3, name: 'الصف الثالث الأساسي', code: 'GRADE3KEY3' },
  { grade: 3, name: 'الصف الثالث الأساسي', code: 'GRADE3KEY4' },
  { grade: 3, name: 'الصف الثالث الأساسي', code: 'GRADE3KEY5' },
  
  // Grade 4 access codes
  { grade: 4, name: 'الصف الرابع الأساسي', code: 'ELEM4TH2024' },
  { grade: 4, name: 'الصف الرابع الأساسي', code: 'GRADE4KEY1' },
  { grade: 4, name: 'الصف الرابع الأساسي', code: 'GRADE4KEY2' },
  { grade: 4, name: 'الصف الرابع الأساسي', code: 'GRADE4KEY3' },
  { grade: 4, name: 'الصف الرابع الأساسي', code: 'GRADE4KEY4' },
  { grade: 4, name: 'الصف الرابع الأساسي', code: 'GRADE4KEY5' },
  
  // Grade 5 access codes
  { grade: 5, name: 'الصف الخامس الأساسي', code: 'ELEM5TH2024' },
  { grade: 5, name: 'الصف الخامس الأساسي', code: 'GRADE5KEY1' },
  { grade: 5, name: 'الصف الخامس الأساسي', code: 'GRADE5KEY2' },
  { grade: 5, name: 'الصف الخامس الأساسي', code: 'GRADE5KEY3' },
  { grade: 5, name: 'الصف الخامس الأساسي', code: 'GRADE5KEY4' },
  { grade: 5, name: 'الصف الخامس الأساسي', code: 'GRADE5KEY5' },
  
  // Grade 6 access codes
  { grade: 6, name: 'الصف السادس الأساسي', code: 'ELEM6TH2024' },
  { grade: 6, name: 'الصف السادس الأساسي', code: 'GRADE6KEY1' },
  { grade: 6, name: 'الصف السادس الأساسي', code: 'GRADE6KEY2' },
  { grade: 6, name: 'الصف السادس الأساسي', code: 'GRADE6KEY3' },
  { grade: 6, name: 'الصف السادس الأساسي', code: 'GRADE6KEY4' },
  { grade: 6, name: 'الصف السادس الأساسي', code: 'GRADE6KEY5' },
  
  // Grade 7 access codes
  { grade: 7, name: 'الصف السابع الأساسي', code: 'MID1ST2024' },
  { grade: 7, name: 'الصف السابع الأساسي', code: 'GRADE7KEY1' },
  { grade: 7, name: 'الصف السابع الأساسي', code: 'GRADE7KEY2' },
  { grade: 7, name: 'الصف السابع الأساسي', code: 'GRADE7KEY3' },
  { grade: 7, name: 'الصف السابع الأساسي', code: 'GRADE7KEY4' },
  { grade: 7, name: 'الصف السابع الأساسي', code: 'GRADE7KEY5' },
  
  // Grade 8 access codes
  { grade: 8, name: 'الصف الثامن الأساسي', code: 'MID2ND2024' },
  { grade: 8, name: 'الصف الثامن الأساسي', code: 'GRADE8KEY1' },
  { grade: 8, name: 'الصف الثامن الأساسي', code: 'GRADE8KEY2' },
  { grade: 8, name: 'الصف الثامن الأساسي', code: 'GRADE8KEY3' },
  { grade: 8, name: 'الصف الثامن الأساسي', code: 'GRADE8KEY4' },
  { grade: 8, name: 'الصف الثامن الأساسي', code: 'GRADE8KEY5' },
  
  // Grade 9 access codes
  { grade: 9, name: 'الصف التاسع الأساسي', code: 'MID3RD2024' },
  { grade: 9, name: 'الصف التاسع الأساسي', code: 'GRADE9KEY1' },
  { grade: 9, name: 'الصف التاسع الأساسي', code: 'GRADE9KEY2' },
  { grade: 9, name: 'الصف التاسع الأساسي', code: 'GRADE9KEY3' },
  { grade: 9, name: 'الصف التاسع الأساسي', code: 'GRADE9KEY4' },
  { grade: 9, name: 'الصف التاسع الأساسي', code: 'GRADE9KEY5' },
  
  // Grade 10 access codes
  { grade: 10, name: 'الصف العاشر الأساسي', code: 'HIGH1ST2024' },
  { grade: 10, name: 'الصف العاشر الأساسي', code: 'GRADE10KEY1' },
  { grade: 10, name: 'الصف العاشر الأساسي', code: 'GRADE10KEY2' },
  { grade: 10, name: 'الصف العاشر الأساسي', code: 'GRADE10KEY3' },
  { grade: 10, name: 'الصف العاشر الأساسي', code: 'GRADE10KEY4' },
  { grade: 10, name: 'الصف العاشر الأساسي', code: 'GRADE10KEY5' },
  
  // Grade 11 access codes
  { grade: 11, name: 'الصف الحادي عشر', code: 'HIGH2ND2024' },
  { grade: 11, name: 'الصف الحادي عشر', code: 'GRADE11KEY1' },
  { grade: 11, name: 'الصف الحادي عشر', code: 'GRADE11KEY2' },
  { grade: 11, name: 'الصف الحادي عشر', code: 'GRADE11KEY3' },
  { grade: 11, name: 'الصف الحادي عشر', code: 'GRADE11KEY4' },
  { grade: 11, name: 'الصف الحادي عشر', code: 'GRADE11KEY5' },
  
  // Grade 12 access codes
  { grade: 12, name: 'الصف الثاني عشر', code: 'HIGH3RD2024' },
  { grade: 12, name: 'الصف الثاني عشر', code: 'GRADE12KEY1' },
  { grade: 12, name: 'الصف الثاني عشر', code: 'GRADE12KEY2' },
  { grade: 12, name: 'الصف الثاني عشر', code: 'GRADE12KEY3' },
  { grade: 12, name: 'الصف الثاني عشر', code: 'GRADE12KEY4' },
  { grade: 12, name: 'الصف الثاني عشر', code: 'GRADE12KEY5' },
  
  // Admin access
  { grade: 0, name: 'المدير - جميع الصفوف', code: '1912191984', isAdmin: true }
];

// Empty teacher data object - no default teachers
export const teachersData = {};

// Get all access codes (including teacher-generated ones)
let dynamicAccessCodes: GradeAccess[] = [];

export const getGradeByCode = (code: string): GradeAccess | null => {
  // First check static codes
  const staticCode = gradeAccessCodes.find(grade => grade.code === code);
  if (staticCode) return staticCode;
  
  // Then check dynamic codes from localStorage
  try {
    // Check all teacher access codes
    for (const teacherId of Object.keys(teachersData)) {
      const savedCodes = localStorage.getItem(`teacher-access-codes-${teacherId}`);
      if (savedCodes) {
        const teacherCodes = JSON.parse(savedCodes);
        const foundCode = teacherCodes.find((c: any) => c.code === code && c.isActive);
        
        if (foundCode) {
          // Check if code is expired
          if (foundCode.expiresAt && new Date(foundCode.expiresAt).getTime() < Date.now()) {
            continue;
          }
          
          // Check if code has reached max usage
          if (foundCode.maxUsage && foundCode.usageCount >= foundCode.maxUsage) {
            continue;
          }
          
          // Increment usage count
          const updatedCodes = teacherCodes.map((c: any) => 
            c.code === code ? { ...c, usageCount: (c.usageCount || 0) + 1 } : c
          );
          localStorage.setItem(`teacher-access-codes-${teacherId}`, JSON.stringify(updatedCodes));
          
          // Return grade access
          const teacher = teachersData[teacherId as keyof typeof teachersData];
          const gradeName = `الصف ${foundCode.grade}`;
          
          return {
            grade: foundCode.grade,
            name: gradeName,
            code: foundCode.code
          };
        }
      }
    }
    
    return null;
  } catch (error) {
    console.error('Error checking dynamic access codes:', error);
    return null;
  }
};

export const getTeacherByCode = (code: string) => {
  const gradeAccess = getGradeByCode(code);
  if (gradeAccess?.isTeacher && gradeAccess.teacherId) {
    return teachersData[gradeAccess.teacherId as keyof typeof teachersData];
  }
  return null;
};

export const getGradesByUser = (userGrade: number, isAdmin: boolean = false): GradeAccess[] => {
  if (isAdmin) {
    return gradeAccessCodes;
  }
  return gradeAccessCodes.filter(grade => grade.grade === userGrade);
};